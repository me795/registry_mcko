<!DOCTYPE html>
<html lang="ru" xmlns="http://www.w3.org/1999/xhtml" content="text/html;" xmlns:th="http://www.thymeleaf.org">
<head th:replace="template::header (${scriptsVersion})"></head>
<body>

<aside th:replace="menu::left_panel"></aside>
<!-- Right Panel -->
<div id="right-panel" class="right-panel">
    <header th:replace="menu::top_panel"></header>

    <div class="breadcrumbs">
        <div class="breadcrumbs-inner">
            <div class="row m-0">
                <div class="col-sm-4">
                    <div class="page-header float-left">
                        <div class="page-title">
                            <h1>Реестр организаций</h1>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="content">



        <form id="registry-organization-form" action="/registry/organization" method="post" class="">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div style="padding-bottom: 50px;">
                <table style="width: 800px;">
                    <thead>
                    <tr>
                        <th style="width: 250px;">Организация:</th>
                        <th style="width: 250px;">Должностное лицо:</th>
                        <th style="width: 300px;">Дата подписания документа:</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr style="line-height: 50px;">
                        <td style="width: 10px;">
                            <select id="organization-id" name="organizationId"
                                    class="organization-select form-control select-box organization-id">
                                <option th:value="${selectedOrganization?.id}"
                                        th:text="${selectedOrganization?.shortName}"
                                        selected="selected"></option>
                            </select>
                        </td>
                        <td style="width: 10px;">
                            <select id="delegate-id" name="delegateId"
                                    class="delegate-select form-control select-box delegate-id">
                                <th:block th:if="${selectedDelegate} == null">
                                    <option></option>
                                </th:block>
                                <th:block th:if="${selectedDelegate} != null">
                                <option th:value="${selectedDelegate?.id}"
                                        th:text="${selectedDelegate?.surname} + ' ' + ${selectedDelegate?.name} + ' ' + ${selectedDelegate?.middleName}"
                                        selected="selected"></option>
                                </th:block>
                            </select>
                        </td>
                        <td style="width: 10px;">
                            <input type="date" name="date" id="document-date"
                                   placeholder="Дата подписания документа"
                                   th:value="(${date} != null) ? ${#dates.format(date, 'yyyy-MM-dd')} : ''"
                                   class="form-control">
                        </td>

                    </tr>
                    <tr>
                        <td>
                            <button id="registry-organization-form-button" type="submit" class="btn btn-primary btn-sm">
                                <i class="fa"></i>&nbsp;Поиск
                            </button>
                        </td>
                        <td>
                        </td>
                        <td>
                            <a href="/registry/organization">Очистить фильтры</a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </form>
        <div>
            <th:block th:if="${organizationList == null}">
                <div class="alert alert-primary" role="alert">
                    Введите параметры поиска
                </div>
            </th:block>
            <th:block th:if="${organizationList != null}">
                <th:block th:if="${#lists.size(organizationList) == 0}">
                    <div class="alert alert-primary" role="alert">
                        По вашему запросу ничего не найдено
                    </div>
                </th:block>
                <th:block th:if="${#lists.size(organizationList) > 0}">
                    <table id="registry-organization-table" class="table table-bordered">
                        <thead>
                        <tr>
                            <th class="serial" rowspan="3">#</th>
                            <th colspan="8">
                                Сведения об организации (индивидуальном предпринимателе), уполномоченной(ом) на выдачу
                                документов об образовании и (или) о квалификации, об ученых степенях, ученых званиях за
                                период с 1992 года
                            </th>
                            <th colspan="9">
                                Уполномоченное должностное лицо
                            </th>
                            <th colspan="3">
                                Образцы оттиска печати
                            </th>
                        </tr>
                        <tr>
                            <th rowspan="2">Полное наименование организации (ФИО индивидуального предпринимателя)</th>
                            <th rowspan="2">Сокращенное наименование</th>
                            <th rowspan="2">Организационно-правовая форма</th>
                            <th rowspan="2">Тип образовательной организации</th>
                            <th rowspan="2">ОГРН (ОГРНИП)</th>
                            <th rowspan="2">ИНН</th>
                            <th colspan="2">Период существования</th>
                            <th rowspan="2">ФИО должностного лица, уполномоченного подписывать документы об образовании
                                и (или) о квалификации, об ученых степенях, ученых званиях
                            </th>
                            <th rowspan="2">Должность</th>
                            <th colspan="3">Реквизиты документа, подтверждающего полномочия указанного должностного
                                лица
                            </th>
                            <th colspan="2">Период осуществления полномочий</th>
                            <th rowspan="2">Полномочие (указывается наименование документа, который уполномочно
                                подписывать должностное лицо)
                            </th>
                            <th rowspan="2">Образец подписи</th>
                            <th rowspan="2">Образец оттиска печати, используемого для заверения документов об
                                образовании и (или) о квалификации, об ученых степенях, ученых званиях.
                            </th>
                            <th colspan="2">Период действия печати</th>
                        </tr>
                        <tr>
                            <th>дата начала</th>
                            <th>дата окончания</th>
                            <th>вид документа</th>
                            <th>номер документа</th>
                            <th>дата документа</th>
                            <th>дата начала</th>
                            <th>дата окончания</th>
                            <th>дата начала</th>
                            <th>дата окончания</th>
                        </tr>
                        </thead>
                        <tbody>
                        <th:block th:each="organization : ${organizationList}">
                            <th:block th:each="stamp : ${organization.stampList}">
                                <th:block th:each="od : ${stamp.organizationDelegateByStampList}">
                                    <tr>
                                        <td class="serial"></td>
                                        <td th:text="${organization.name}"></td>
                                        <td th:text="${organization.shortName}"></td>
                                        <td th:text="${organization.organizationOPF}"></td>
                                        <td th:text="${organization.organizationType}"></td>
                                        <td th:text="${organization.ogrn}"></td>
                                        <td th:text="${organization.inn}"></td>
                                        <td th:text="(${organization.activityStartedAt} != null) ? ${#dates.format(organization.activityStartedAt, 'dd-MM-yyyy')} : ''"></td>
                                        <td th:text="(${organization.activityFinishedAt} != null) ? ${#dates.format(organization.activityFinishedAt, 'dd-MM-yyyy')} : ''"></td>
                                        <td th:text="${od.delegate.surname} + ' ' + ${od.delegate.name} + ' ' + ${od.delegate.middleName}"></td>
                                        <td th:text="${od.position}"></td>
                                        <td th:text="${od.orderDocumentType}"></td>
                                        <td th:text="${od.orderDocumentNum}"></td>
                                        <td th:text="(${od.orderDocumentDate} != null) ? ${#dates.format(od.orderDocumentDate, 'dd-MM-yyyy')} : ''"></td>
                                        <td th:text="(${od.activityStartedAt} != null) ? ${#dates.format(od.activityStartedAt, 'dd-MM-yyyy')} : ''"></td>
                                        <td th:text="(${od.activityFinishedAt} != null) ? ${#dates.format(od.activityFinishedAt, 'dd-MM-yyyy')} : ''"></td>
                                        <td>
                                            <th:block th:each="doc : ${od.documentTypeList}">
                                                <span th:text="${doc.name} + ', '"></span>
                                            </th:block>
                                        </td>
                                        <td>
                                            <img class="small-image" data-toggle="modal" data-target="#smallmodal" th:src="${od.delegate.signatureLink}" style="width: 150px;">
                                        </td>
                                        <td>
                                            <img class="small-image" data-toggle="modal" data-target="#smallmodal" th:src="${stamp.link}" style="width: 150px;">
                                        </td>
                                        <td th:text="(${stamp.activityStartedAt} != null) ? ${#dates.format(stamp.activityStartedAt, 'dd-MM-yyyy')} : ''"></td>
                                        <td th:text="(${stamp.activityFinishedAt} != null) ? ${#dates.format(stamp.activityFinishedAt, 'dd-MM-yyyy')} : ''"></td>
                                    </tr>
                                </th:block>
                            </th:block>
                        </th:block>
                        </tbody>
                    </table>
                </th:block>
            </th:block>
        </div>
    </div>

    <div class="modal fade" id="smallmodal" tabindex="-1" role="dialog" aria-labelledby="smallmodalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <img id="big-image">
                </div>
            </div>
        </div>
    </div>

    <div class="clearfix"></div>
    <footer th:replace="menu::footer"></footer>
</div>


<div th:replace="template::scripts (${scriptsVersion})"></div>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
<script src="/assets/js/registry-organization.js"></script>

</body>
</html>