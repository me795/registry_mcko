<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ru.mcko.registry.repository.read.OrganizationDelegateRepositoryRead">


    <resultMap id="organizationDelegateMap" type="ru.mcko.registry.entity.OrganizationDelegate">
        <id column="od_id" property="id"/>
        <result column="od_position" property="position"/>
        <result column="od_order_document_type" property="orderDocumentType"/>
        <result column="od_order_document_num" property="orderDocumentNum"/>
        <result column="od_order_document_date" property="orderDocumentDate"/>
        <result column="od_activity_started_at" property="activityStartedAt"/>
        <result column="od_activity_finished_at" property="activityFinishedAt"/>
        <result column="od_created_at" property="createdAt"/>
        <result column="od_updated_at" property="updatedAt"/>
        <result column="od_deleted_at" property="deletedAt"/>
        <association property="delegate" resultMap="delegateMap"/>
        <collection property="documentTypeList" resultMap="docTypeMap"/>
    </resultMap>

    <resultMap id="delegateMap" type="ru.mcko.registry.entity.Delegate">
        <id column="d_id" property="id"/>
        <result column="d_surname" property="surname"/>
        <result column="d_name" property="name"/>
        <result column="d_middle_name" property="middleName"/>
        <result column="d_signature_link" property="signatureLink"/>
    </resultMap>

    <resultMap id="docTypeMap" type="ru.mcko.registry.entity.DocumentType">
        <id column="dt_id" property="id"/>
        <result column="dt_name" property="name"/>
    </resultMap>


    <select id="listByOrganization" resultMap="organizationDelegateMap">
        SELECT organization_delegate.id                   AS od_id,
               organization_delegate.position             AS od_position,
               organization_delegate.order_document_type  AS od_order_document_type,
               organization_delegate.order_document_num   AS od_order_document_num,
               organization_delegate.order_document_date  AS od_order_document_date,
               organization_delegate.activity_started_at  AS od_activity_started_at,
               organization_delegate.activity_finished_at AS od_activity_finished_at,
               organization_delegate.created_at           AS od_created_at,
               organization_delegate.updated_at           AS od_updated_at,
               organization_delegate.deleted_at           AS od_deleted_at,
               document_type.id                           AS dt_id,
               document_type.name                         AS dt_name,
               delegates.id                               AS d_id,
               delegates.surname                          AS d_surname,
               delegates.name                             AS d_name,
               delegates.middle_name                      AS d_middle_name,
               delegates.signature_link                   AS d_signature_link
        FROM organization_delegate
                 LEFT JOIN delegates ON organization_delegate.delegate_id = delegates.id
                 LEFT JOIN organization_delegate_document_type
                           ON organization_delegate_document_type.organization_delegate_id = organization_delegate.id
                 LEFT JOIN document_type ON organization_delegate_document_type.document_type_id = document_type.id
        WHERE 1 = 1
          AND organization_delegate.organization_id = #{organizationId};
    </select>

    <select id="listActiveByOrganization" resultMap="organizationDelegateMap">
        SELECT organization_delegate.id                   AS od_id,
               organization_delegate.position             AS od_position,
               organization_delegate.order_document_type  AS od_order_document_type,
               organization_delegate.order_document_num   AS od_order_document_num,
               organization_delegate.order_document_date  AS od_order_document_date,
               organization_delegate.activity_started_at  AS od_activity_started_at,
               organization_delegate.activity_finished_at AS od_activity_finished_at,
               organization_delegate.created_at           AS od_created_at,
               organization_delegate.updated_at           AS od_updated_at,
               organization_delegate.deleted_at           AS od_deleted_at,
               document_type.id                           AS dt_id,
               document_type.name                         AS dt_name,
               delegates.id                               AS d_id,
               delegates.surname                          AS d_surname,
               delegates.name                             AS d_name,
               delegates.middle_name                      AS d_middle_name,
               delegates.signature_link                   AS d_signature_link
        FROM organization_delegate
                 LEFT JOIN delegates ON organization_delegate.delegate_id = delegates.id
                 LEFT JOIN organization_delegate_document_type
                           ON organization_delegate_document_type.organization_delegate_id = organization_delegate.id
                 LEFT JOIN document_type ON organization_delegate_document_type.document_type_id = document_type.id
        WHERE 1 = 1
          AND organization_delegate.organization_id = #{organizationId}
          AND organization_delegate.deleted_at IS NULL;
    </select>

    <select id="getById" resultMap="organizationDelegateMap">
        SELECT organization_delegate.id                   AS od_id,
               organization_delegate.position             AS od_position,
               organization_delegate.order_document_type  AS od_order_document_type,
               organization_delegate.order_document_num   AS od_order_document_num,
               organization_delegate.order_document_date  AS od_order_document_date,
               organization_delegate.activity_started_at  AS od_activity_started_at,
               organization_delegate.activity_finished_at AS od_activity_finished_at,
               organization_delegate.created_at           AS od_created_at,
               organization_delegate.updated_at           AS od_updated_at,
               organization_delegate.deleted_at           AS od_deleted_at,
               document_type.id                           AS dt_id,
               document_type.name                         AS dt_name,
               delegates.id                               AS d_id,
               delegates.surname                          AS d_surname,
               delegates.name                             AS d_name,
               delegates.middle_name                      AS d_middle_name,
               delegates.signature_link                   AS d_signature_link
        FROM organization_delegate
                 LEFT JOIN delegates ON organization_delegate.delegate_id = delegates.id
                 LEFT JOIN organization_delegate_document_type
                           ON organization_delegate_document_type.organization_delegate_id = organization_delegate.id
                 LEFT JOIN document_type ON organization_delegate_document_type.document_type_id = document_type.id
        WHERE 1 = 1
          AND organization_delegate.id = #{id};
    </select>


</mapper>