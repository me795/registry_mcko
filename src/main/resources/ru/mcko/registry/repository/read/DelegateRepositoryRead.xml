<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ru.mcko.registry.repository.read.DelegateRepositoryRead">

    <resultMap id="delegateMap" type="ru.mcko.registry.entity.Delegate">
        <id column="id" property="id"/>
        <result column="surname" property="surname"/>
        <result column="name" property="name"/>
        <result column="middle_name" property="middleName"/>
        <result column="signature_link" property="signatureLink"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="deleted_at" property="deletedAt"/>
    </resultMap>


    <select id="listByFIO" resultMap="delegateMap">
        SELECT
        *
        FROM
        delegates
        WHERE 1=1
        AND deleted_at IS NULL
        <if test="params.firstName != null">
            and lower(name) = #{params.name}
        </if>
        <if test="params.middleName != null">
            and lower(middle_name) = #{params.middleName}
        </if>
        and lower(surname) like #{params.surname}
    </select>

    <select id="listAll" resultMap="delegateMap">
        SELECT
        *
        FROM
        delegates
        WHERE 1=1
        AND deleted_at IS NULL
        <if test="params.firstName != null">
            and lower(name) = #{params.name}
        </if>
        <if test="params.middleName != null">
            and lower(middle_name) = #{params.middleName}
        </if>
        and lower(surname) like #{params.surname}
    </select>


    <select id="list" resultMap="delegateMap">
        SELECT
        *
        FROM
        delegates
        WHERE 1=1
        AND deleted_at IS NULL
        <if test="params.firstName != null">
            and lower(name) = #{params.name}
        </if>
        <if test="params.middleName != null">
            and lower(middle_name) = #{params.middleName}
        </if>
        <if test="params.surname != null">
            and lower(surname) like #{params.surname}
        </if>
        <if test='"id".equalsIgnoreCase(params.orderColumn)'>
            ORDER BY id
        </if>
        <if test='"surname".equalsIgnoreCase(params.orderColumn)'>
            ORDER BY surname
        </if>
        <if test='"name".equalsIgnoreCase(params.orderColumn)'>
            ORDER BY name
        </if>
        <if test='"middle_name".equalsIgnoreCase(params.orderColumn)'>
            ORDER BY middle_name
        </if>
        <if test='"created_at".equalsIgnoreCase(params.orderColumn)'>
            ORDER BY created_at
        </if>
        <if test='"updated_at".equalsIgnoreCase(params.orderColumn)'>
            ORDER BY updated_at
        </if>
        <if test='"deleted_at".equalsIgnoreCase(params.orderColumn)'>
            ORDER BY deleted_at
        </if>
        <if test="params.asc != null">
            ASC
        </if>
        <if test="params.asc == null">
            DESC
        </if>
        <if test="params.limit != null">
            LIMIT #{params.limit}
        </if>
        <if test="params.offset != null">
            OFFSET #{params.offset}
        </if>;
    </select>


    <select id="countWithFilter" resultType="java.lang.Long">
        SELECT
        count(*)
        FROM
        delegates
        WHERE 1=1
        AND deleted_at IS NULL
        <if test="params.firstName != null">
            and lower(name) = #{params.name}
        </if>
        <if test="params.middleName != null">
            and lower(middle_name) = #{params.middleName}
        </if>
        <if test="params.surname != null">
            and lower(surname) like #{params.surname}
        </if>;
    </select>

    <select id="count" resultType="java.lang.Long">
        SELECT count(*)
        FROM delegates
        WHERE 1 = 1
          AND deleted_at IS NULL;
    </select>

    <select id="countAll" resultType="java.lang.Long">
        SELECT count(*)
        FROM delegates
        WHERE 1 = 1
          AND deleted_at IS NULL;
    </select>

    <select id="getById" resultMap="delegateMap">
        SELECT *
        FROM delegates
        WHERE id = #{id};
    </select>

</mapper>